# 1. 概念

| 名词 | 概念 |
| --- | --- | 
| 拥塞 |  即对资源的需求超过了可用的资源. 若网络中许多资源同时供应不足, 网络的性能就要明显变坏, 整个网络的吞吐量随之负荷的增大而下降. |
| 拥塞控制 | 防止过多的数据注入到网络中, 这样可以使网络中的路由器或链路不致过载. 拥塞控制所要做的都有一个前提: 网络能够承受现有的网络负荷. 拥塞控制是一个全局性的过程, 涉及到所有的主机, 路由器, 以及与降低网络传输性能有关的所有因素. |
| 流量控制 | 指点对点通信量的控制, 是端到端的问题, 流量控制所要做的就是抑制发送端发送数据的速率, 以便使接收端来得及接收. |
| 拥塞控制代价 | 需要获得网络内部流量分布的信息. 在实施拥塞控制之前, 还需要在结点之间交换信息和各种命令, 以便选择控制的策略和实施控制, 这样就产生了额外的开销. 拥塞控制还需要将一些资源分配给各个用户单独使用, 使得网络资源不能更好地实现共享. |

# 2. 拥塞控制方法
## 2.1 慢启动和拥塞避免
发送方维持一个拥塞窗口 `cwnd(congestion window)` 的状态变量, 拥塞窗口的大小取决于网络的拥塞程度, 并且动态地在变化. 发送方让自己的发送窗口等于拥塞. 

发送方控制拥塞窗口的原则是: 只要网络没有出现拥塞, 拥塞窗口就再增大一些, 以便把更多的分组发送出去. 但只要网络出现拥塞, 拥塞窗口就减小一些, 以减少注入到网络中的分组数.

> 慢开始算法: 当主机开始发送数据时，如果立即将大量数据字节注入到网络, 那么就有可能引起网络拥塞, 因为现在并不清楚网络的负荷情况.   
因此, 较好的方法是先探测一下, 即由小到大逐渐增大发送窗口, 也就是说, 由小到大逐渐增大拥塞窗口数值. 通常在刚刚开始发送报文段时, 先把拥塞窗口 `cwnd` 设置为一个最大报文段 MSS 的数值. 而在每收到一个对新的报文段的确认后, 把拥塞窗口增加至多一个 MSS 的数值. 用这样的方法逐步增大发送方的拥塞窗口 `cwnd`, 可以使分组注入到网络的速率更加合理.

![](.tcp-congestion-control_images/35cc2697.png)

每经过一个传输轮次, 拥塞窗口 `cwnd` 就加倍. 一个传输轮次所经历的时间其实就是往返时间 `RTT`. 不过 `传输轮次` 更加强调: 把拥塞窗口 cwnd 所允许发送的报文段都连续发送出去, 并收到了对已发送的最后一个字节的确认.

慢开始的 `慢` 并不是指 cwnd 的增长速率慢, 而是指在 TCP 开始发送报文段时先设置 `cwnd=1`, 使得发送方在开始时只发送一个报文段(目的是试探一下网络的拥塞情况), 然后再逐渐增大 cwnd.

为了防止拥塞窗口 cwnd 增长过大引起网络拥塞, 还需要设置一个慢开始门限 `ssthresh` 状态变量, 慢开始门限 ssthresh 的用法如下:
- 当 cwnd < ssthresh 时, 使用上述的慢开始算法;
- 当 cwnd > ssthresh 时, 停止使用慢开始算法而改用拥塞避免算法;
- 当 cwnd = ssthresh 时, 既可使用慢开始算法, 也可使用拥塞控制避免算法;

拥塞避免算法: 让拥塞窗口cwnd缓慢地增大，即每经过一个往返时间RTT就把发送方的拥塞窗口cwnd加1，而不是加倍。这样拥塞窗口cwnd按线性规律缓慢增长，比慢开始算法的拥塞窗口增长速率缓慢得多。